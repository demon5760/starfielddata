{{ define "main" }}
{{ $resource_name := .Page.Title }}
{{ $resource := index $.Site.Data.resources $resource_name }}

{{ $credits := slice }}
{{ if $resource.credits }}
  {{ $credits = $credits | append $resource.credits}}
{{ end }}


<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        
        {{ .Content }}

      </article>
      <div>
        <h2>Locations</h2>
        {{ $resource.name }} can be found on on the following planets and moons.

        <table>
          <tr>
            <th>Name</th>
            <th>System</th>
          </tr>
          {{ range $.Site.Data.planets }}
            {{ if in .resources $resource.name }}
              {{ $planet_page_file := printf "/locations/planets/%s" .name }}
              {{ $planet_page := $.Site.GetPage $planet_page_file }}

              {{ $system_page_file := printf "/locations/systems/%s" .system }}
              {{ $system_page := $.Site.GetPage $system_page_file }}

              <tr>
                <td>
                  {{ if $planet_page }}
                    <a href="{{ $planet_page.Permalink }}">{{.name}}</a>
                  {{ else }}
                    {{.name}}
                  {{ end }}
                  
                </td>
                <td>
                  {{ if $system_page }}
                    <a href="{{ $system_page.Permalink }}">{{.system}}</a>
                  {{ else }}
                    {{.system}}
                  {{ end }}
                  
                </td>
              </tr>
            {{end }}
          {{ end }}

          {{ range $.Site.Data.moons }}
          {{ if in .resources $resource.name }}
            {{ $planet_name := .planet }}
            
            {{ $moon_page_file := printf "/locations/moons/%s" .name }}
            {{ $moon_page := $.Site.GetPage $moon_page_file }}

            
            {{ $planet := index $.Site.Data.planets $planet_name  }}
            {{ $system_page_file := printf "/locations/systems/%s" $planet.system }}
            {{ $system_page := $.Site.GetPage $system_page_file }}

            <tr>
              <td>
                {{ if $moon_page }}
                  <a href="{{ $moon_page.Permalink }}">{{.name}}</a>
                {{ else }}
                  {{.name}}
                {{ end }}
                
              </td>
              <td>
                {{ if $system_page }}
                  <a href="{{ $system_page.Permalink }}">{{$planet.system}}</a>
                {{ else }}
                  {{.system}}
                {{ end }}
                
              </td>
            </tr>
          {{end }}
        {{ end }}
        </table>
      </div>
     
      {{ partial "page_credits.html" (slice $.Site.Data.sources $credits) }}
    </div>
  </div>
</div>
{{ end }}
